<div class="flex min-h-screen flex-col bg-tttBlack text-tttWhite">
    <div class="relative z-50">
        <ttt-header></ttt-header>
    </div>

    <div class="flex flex-1 flex-col md:flex-row">
        <main class="flex-1">
            <router-outlet />
        </main>
        <nav class="order-first md:w-64 bg-tttGray-900 border-r border-tttGray-800">
            <div class="p-6">
                <h3 class="mb-4 text-lg font-bold text-tttWhite">{{ sidebarContent.left.title }}</h3>
                <div class="space-y-3">
                    <div class="rounded-lg bg-tttGray-800 border border-tttGray-700 p-4">


                        <!-- Upcoming events (compact) -->
                        <div class="mb-3">
                            <ul class="space-y-2">
                                <li *ngFor="let ev of events$ | async" class="text-sm text-tttGray-300">
                                    <a [href]="ev.eventUrl" target="_blank" rel="noopener noreferrer"
                                       class="block group focus:outline-none relative"
                                       [attr.aria-describedby]="'evt-'+ev.id">
                                        <div class="">
                                            <div class="truncate">
                                                <!-- Title (single-line, truncated) -->
                                                <div class="font-medium text-tttWhite text-sm truncate"
                                                     [attr.title]="ev.title">
                                                    {{ ev.title }}
                                                </div>
                                                <div class="text-xs text-tttGray-400">
                                                    {{ ev.date | date:'dd.MM.yyyy' }} • {{ ev.startTime }} • {{ ev.durationHours }} h
                                                </div>
                                            </div>
                                        </div>
                                        <!-- type moved inline with metadata -->

                                        <!-- Fancy tooltip / popover shown on hover or keyboard focus -->
                                        <div role="tooltip" [id]="'evt-'+ev.id"
                                             class="hidden group-hover:block group-focus:block focus-within:block absolute left-0 top-full mt-2 w-[min(20rem,90vw)] max-w-xs bg-tttWhite text-tttBlack p-3 rounded shadow-lg z-50 whitespace-normal">
                                            <div class="text-sm font-semibold">{{ ev.title }}</div>
                                            <div class="text-xs text-tttGray-500 mt-1">{{ ev.date | date:'dd.MM.yyyy' }} • {{ ev.startTime }} • {{ ev.durationHours }} h</div>
                                            <div class="mt-2">
                                                <span class="inline-block text-xs rounded px-2 py-1 bg-tttRed text-tttWhite font-medium">{{ ev.type }}</span>
                                            </div>
                                        </div>
                                    </a>
                                </li>
                                <li *ngIf="(events$ | async)?.length === 0" class="text-sm text-tttGray-400">Keine anstehenden Events</li>
                            </ul>
                        </div>

                        <!-- End of events card -->
                    </div>

                    <!-- Separate widget: Interner Bereich -->
                    <div class="rounded-lg bg-tttGray-800 border border-tttGray-700 p-4">
                        <div class="text-center">
                            <a *ngIf="sidebarContent.left?.intern?.routerLink"
                               [routerLink]="sidebarContent.left.intern.routerLink"
                               class="inline-flex items-center gap-2 rounded-lg bg-tttRed px-4 py-2 text-sm font-medium text-tttWhite hover:bg-tttRed-600 transition-colors mx-auto"
                               [attr.aria-label]="sidebarContent.left.intern.ariaLabel">
                                <i class="pi pi-users"></i>
                                {{ sidebarContent.left.intern.label }}
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </nav>
        <aside class="md:w-64 bg-tttGray-900 border-l border-tttGray-800">
            <div class="p-6">
                <h3 class="mb-4 text-lg font-bold text-tttWhite">
                    <i [class]="discordIcon.class"></i>
                    {{ sidebarContent.right.title }}
                </h3>
                <div class="space-y-3">
                    <!-- Discord Widget -->
                    <div class="rounded-lg bg-tttGray-800 border border-tttGray-700 overflow-hidden">
                        <iframe 
                            src="https://discord.com/widget?id=121399943393968128&theme=dark" 
                            width="100%" 
                            height="400" 
                            sandbox="allow-popups allow-same-origin allow-scripts"
                            class="w-full border-0"
                            title="TTT Discord Server">
                        </iframe>
                    </div>
                    
                    <!-- Fallback Discord Link -->
                    <div class="rounded-lg bg-tttGray-800 border border-tttGray-700 p-4">
                        <div class="text-center">
                            <p class="text-sm text-tttGray-300 mb-3">{{ sidebarContent.right.fallback.message }}</p>
                            <a [href]="discordConfig.directUrl" 
                               target="_blank"
                               class="inline-flex items-center gap-2 rounded-lg bg-[#5865F2] px-4 py-2 text-sm font-medium text-white hover:bg-[#4752C4] transition-colors">
                                <i class="pi pi-discord"></i>
                                {{ sidebarContent.right.fallback.buttonText }}
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </aside>
    </div>

    <ttt-footer></ttt-footer>
</div>
